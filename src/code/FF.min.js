Ajax.METHOD_TYPE_GET="GET";Ajax.METHOD_TYPE_POST="POST";Ajax.METHOD_TYPE_DELETE="DELETE";Ajax.METHOD_TYPE_PUT="PUT";Ajax.METHOD_TYPE_HEAD="HEAD";Ajax.METHOD_TYPE_OPTIONS="OPTIONS";Ajax.METHOD_TYPE_TRACE="TRACE";Ajax.METHOD_TYPE_CONNECT="CONNECT";Ajax.TIMEOUT_DEFAULT=15000;Ajax.HEADER_CONTENT_TYPE="Content-Type";Ajax.CONTENT_TYPE_VALUE_FORM_ENCODED="application/x-www-form-urlencoded";Ajax.CONTENT_TYPE_VALUE_IMAGE_ANY="image/*";Ajax.CONTENT_TYPE_VALUE_IMAGE_PNG="image/png";Ajax.CONTENT_TYPE_VALUE_IMAGE_JPG="image/jpeg";Ajax.CONTENT_TYPE_VALUE_IMAGE_GIF="image/gif";Ajax.CONTENT_TYPE_VALUE_TEXT_ANY="text/*";Ajax.CONTENT_TYPE_VALUE_JAVASCRIPT_TEXT="text/javascript";Ajax.CONTENT_TYPE_VALUE_JAVASCRIPT_APPLICATION="application/javascript";Ajax.HEADER_ACCEPT="Accept";Ajax.HEADER_ACCEPT_CHARSET="Accept-Charset";Ajax.HEADER_ACCEPT_LANGUAGE="Accept-Language";Ajax.HEADER_AUTHORIZATION="Authorization";Ajax.HEADER_CACHE_CONTROL="Cache-Control";Ajax.HEADER_CONTENT_ENCODING="Content-Encoding";Ajax.HEADER_CONTENT_LANGUAGE="Content-Language";Ajax.HEADER_CONTENT_LENGTH="Content-Length";Ajax.HEADER_DATE="Date";Ajax.HEADER_E_TAG="ETag";Ajax.HEADER_EXPIRES="Expores";Ajax.HEADER_IF_MODIFIED_SINCE="If-Modified-Since";Ajax.HEADER_LAST_MODIFIED="Last-Modified";Ajax.HEADER_LOCATION="Location";Ajax.HEADER_ORIGIN="Origin";Ajax.HEADER_REFERER="Referer";Ajax.HEADER_USER_AGENT="User-Agent";function Ajax(a){this._method=Ajax.METHOD_TYPE_GET;this._params=null;this._formData=null;this._url=null;this._context=null;this._callback=null;this._header={};this._binary=false;this._cache=false;this._request=new XMLHttpRequest();this._request.onreadystatechange=this._stateChangeCaller;this._request.context=this;this.timeout(Ajax.TIMEOUT_DEFAULT);this._autoDestroy=true;if(a){this._autoDestroy=false}}Ajax.prototype.binary=function(a){if(a!==undefined){if(a){this._binary=true;this._request.responseType="arraybuffer"}else{this._request.responseType=""}}return this._binary};Ajax.prototype.cache=function(a){if(a!==undefined&&a!==null){this._cache=a}else{return this._cache}};Ajax.prototype.append=function(a,b){if(!this._formData){this._formData=new FormData()}if(a&&b){this._formData.append(a,b)}};Ajax.prototype.params=function(b){if(b!==undefined&&b!==null){var c="",a=0;for(k in b){if(a>0){c=c+"&"}c=c+k+"="+Code.escapeURI(b[k]);++a}this._params=c}return this._params};Ajax.prototype.method=function(a){if(a!==undefined&&a!==null){this._method=a}return this._method};Ajax.prototype.url=function(a){if(a!==undefined&&a!==null){this._url=a;if(!this._cache){if(this._url.indexOf("?")>=0){this._url=this._url+"&_="+Code.getTimeMilliseconds()+""+Math.floor(Math.random()*10000)}}}return this._url};Ajax.prototype.timeout=function(a){if(a){this._request.timeout=a}return this._request.timeout};Ajax.prototype.callback=function(a){if(a!==undefined){this._callback=a}return this._callback};Ajax.prototype.context=function(a){if(a!==undefined){this._context=a}return this._context};Ajax.prototype.cancel=function(){this._request.abort();this._callCallback(null)};Ajax.prototype.get=function(c,a,b,d){this.context(a);this.send(c,Ajax.METHOD_TYPE_GET,b,d)};Ajax.prototype.post=function(c,a,b,d){this.context(a);this.send(c,Ajax.METHOD_TYPE_POST,b,d)};Ajax.prototype.put=function(){};Ajax.prototype.del=function(){};Ajax.prototype.clearHeader=function(){this._header={}};Ajax.prototype.setHeader=function(b,a){this._header[b]=a};Ajax.prototype.send=function(b,a,c,e){this.url(b);this.method(a);this.callback(c);this.params(e);var d=this._params&&this._params.length>0;var b=this._url;if(d&&this._method==Ajax.METHOD_TYPE_GET){b=b+"?"+this._params}this._request.open(this._method,b,true);this.clearHeader();for(o in this._header){this._request.setRequestHeader(o,this._header[o])}d=this._params!==null;if(this._formData){this._request.send(this._formData)}else{if(d){if(this._method==Ajax.METHOD_TYPE_GET){this._request.send()}else{if(this._method==Ajax.METHOD_TYPE_POST){this._setPostHeaderParameters();this._request.send(this._params)}else{this._request.send(this._params)}}}else{this._request.send()}}};Ajax.prototype.responseCode=function(){var a=this._request.status;return a};Ajax.prototype.responseContent=function(){var a=this._request.responseText;return a};Ajax.prototype._setPostHeaderParameters=function(){this._request.setRequestHeader(Ajax.HEADER_CONTENT_TYPE,Ajax.CONTENT_TYPE_VALUE_FORM_ENCODED)};Ajax.prototype._stateChangeCaller=function(a){this.context._stateChange.call(this.context,a)};Ajax.prototype._callCallback=function(a){if(this._callback){if(this._context){this._callback.call(this._context,a,this)}else{this._callback(a,this)}}};Ajax.prototype._stateChange=function(){if(this._request.readyState==4){var a=null;var b=this._request.status;if(this._binary){var a=this._request.response;a=new Uint8Array(a)}else{a=this._request.responseText}this._callbackResponseCheck(b,a);if(this._autoDestroy){this.kill()}}};Ajax.prototype._callbackResponseCheck=function(b,a){if(Math.floor(b/200)==1||Math.floor(b/300)==1){this._callCallback(a)}else{this._callCallback(null)}};Ajax.prototype.kill=function(){if(this._request){this._request.onreadystatechange=null;this._request=null}this._method=null;this._url=null;this._callback=null;this._context=null;this._header=null;this._binary=null;this._cache=null;this._request=null;this._autoDestroy=null};Ajax._queue=null;Ajax.defaultQueue=function(){if(!Ajax._queue){Ajax._queue=new Ajax.Queue()}return Ajax._queue};Ajax.Queue=function(){this._queue=new PriorityQueue(Ajax.Queue.sortAjax);this._maxProgressCount=5;this._inProgress=[]};Ajax.Queue.sortAjax=function(d,c){if(d==c){return 0}return c.priority-d.priority};Ajax.Queue.prototype.throttle=function(a){if(a!==undefined){this._maxProgressCount=a}return this._maxProgressCount};Ajax.Queue.prototype.length=function(){return this._queue.length()};Ajax.Queue.prototype.addRequest=function(b,a){a=(a!==undefined)?a:1;this._queue.push()};Ajax.Queue.prototype.removeRequest=function(a){var b=this._queue.removeObject(a);if(b){a=b.request;b.kill();return a}return null};Ajax.Queue.prototype._checkNextRequest=function(){if(this._inProgress.length<this._maxProgressCount){var a=this._queue.popMinimum();if(a){a=a.request}}};Ajax.Queue.Request=function(b,a){this.priority=a;this.request=b};Ajax.Queue.Request.prototype.kill=function(){this.priority=undefined;this.request=null};